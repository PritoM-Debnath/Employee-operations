{% extends "employee_registrar/base.html" %}

{% block content %}
<h2>Employee List</h2>

<!-- Search form -->
<form method="GET" action="" class="form-inline mb-3">
    <div class="row">
        <div class="col">
            <input type="text" name="full_name" value="{{ request.GET.full_name }}" class="form-control" placeholder="Full Name">
        </div>
        <div class="col">
            <input type="text" name="email" value="{{ request.GET.email }}" class="form-control" placeholder="Email">
        </div>
        <div class="col">
            <input type="text" name="mobile" value="{{ request.GET.mobile }}" class="form-control" placeholder="Mobile">
        </div>
        <div class="col">
            <input type="date" name="dob" value="{{ request.GET.dob }}" class="form-control" placeholder="Date Of Birth">
        </div>
        <div class="col">
            <button type="submit" class="btn btn-primary">
                <i class="fa fa-search"></i> Search
            </button>
        </div>
    </div>
</form>

<!-- Your existing employee table goes here -->
...
<table class="table table-borderless">
    <thead class="border-bottom font-weight-bold">
        <tr>
            <td>Profile Picture</td>
            <td>
                <a href="?sort_by=first_name&order={% if current_sort_by == 'first_name' and current_sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    Full Name
                    {% if current_sort_by == 'first_name' %}
                        {% if current_sort_order == 'asc' %}
                            &#9650;
                        {% else %}
                            &#9660;
                        {% endif %}
                    {% endif %}
                </a>
            </td>
            <td>
                <a href="?sort_by=email&order={% if current_sort_by == 'email' and current_sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    Email
                    {% if current_sort_by == 'email' %}
                        {% if current_sort_order == 'asc' %}
                            &#9650;
                        {% else %}
                            &#9660;
                        {% endif %}
                    {% endif %}
                </a>
            </td>
            <td>
                <a href="?sort_by=mobile&order={% if current_sort_by == 'mobile' and current_sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    Mobile
                    {% if current_sort_by == 'mobile' %}
                        {% if current_sort_order == 'asc' %}
                            &#9650;
                        {% else %}
                            &#9660;
                        {% endif %}
                    {% endif %}
                </a>
            </td>
            <td>
                <a href="?sort_by=date_of_birth&order={% if current_sort_by == 'date_of_birth' and current_sort_order == 'asc' %}desc{% else %}asc{% endif %}">
                    DOB
                    {% if current_sort_by == 'date_of_birth' %}
                        {% if current_sort_order == 'asc' %}
                            &#9650;
                        {% else %}
                            &#9660;
                        {% endif %}
                    {% endif %}
                </a>
            </td>
            <td>Action</td>
        </tr>
    </thead>   
    <tbody>
        {% for employee in employee_list %}
            <tr>
                <td>
                    {% if employee.photo %}
                        <img src="{{ employee.photo.url }}" alt="{{ employee.first_name }} {{ employee.last_name }}" width="100" height="100">
                    {% else %}
                        {% load static %}
                        <img src="{% static 'media/src/default.jpg' %}" alt="Default Avatar" width="100" height="100">
                    {% endif %}
                </td>
                <td>{{ employee.first_name }} {{ employee.last_name }}</td>
                <td>{{ employee.email }}</td>
                <td>{{ employee.mobile }}</td>
                <td>{{ employee.date_of_birth }}</td>
                <td>
                    <a href="{% url 'employee_update' employee.id %}">
                        <i class="fa-solid fa-user-pen"></i>
                    </a>
                    
                    <button type="button" class="btn btn" data-bs-toggle="modal" data-bs-target="#deleteModal" 
                        onclick="setDeleteAction({{ employee.id }})">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                    
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="6">No employees found.</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<!--Pop up model-->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this employee?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                <form id="deleteForm" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Yes, Delete</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Single line navigator and page info -->
<div class="d-flex justify-content-between align-items-center">
    <div class="text-left">
        Showing {{ employee_list.start_index }} to {{ employee_list.end_index }} of {{ employee_list.paginator.count }}
    </div>

    <nav aria-label="Page navigation">
        <ul class="pagination mb-0">
            {% if employee_list.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page=1&sort_by={{ current_sort_by }}&order={{ current_sort_order }}" aria-label="First">
                        <span aria-hidden="true">&laquo;&laquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ employee_list.previous_page_number }}&sort_by={{ current_sort_by }}&order={{ current_sort_order }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            {% endif %}

            <li class="page-item active"><span class="page-link">{{ employee_list.number }}</span></li>

            {% if employee_list.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ employee_list.next_page_number }}&sort_by={{ current_sort_by }}&order={{ current_sort_order }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?page={{ employee_list.paginator.num_pages }}&sort_by={{ current_sort_by }}&order={{ current_sort_order }}" aria-label="Last">
                        <span aria-hidden="true">&raquo;&raquo;</span>
                    </a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>

<!--dynamic delete operation-->
<script>
    function setDeleteAction(employeeId) {
        const deleteForm = document.getElementById('deleteForm');
        deleteForm.action = `/employee/delete/${employeeId}/`;
    }
</script>
{% endblock content %}
